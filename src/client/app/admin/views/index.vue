<template>
<div class="mk-admin" :class="{ isMobile }">
	<header v-show="isMobile">
		<button class="nav" @click="navOpend = true"><fa icon="bars"/></button>
		<span>MisskeyMyAdmin</span>
	</header>
	<div
		v-if="navOpend && isMobile"
		class="nav-backdrop"
		@click="navOpend = false"
		@touchstart="navOpend = false"
	></div>
	<nav v-show="navOpend">
		<div class="mi">
			<img svg-inline src="../assets/header-icon.svg"/>
		</div>
		<div class="me">
			<img class="avatar" :src="i.avatarUrl" alt="avatar"/>
			<p class="name"><mk-user-name :user="i"/></p>
		</div>
		<ul>
			<li><router-link to="/dashboard" active-class="active"><fa icon="home" :fixed-width="true"/>{{ i18n.t('dashboard') }}</router-link></li>
			<li><router-link to="/instance" active-class="active"><fa icon="cog" :fixed-width="true"/>{{ i18n.t('instance') }}</router-link></li>
			<li><router-link to="/queue" active-class="active"><fa :icon="faTasks" :fixed-width="true"/>{{ i18n.t('queue') }}</router-link></li>
			<li><router-link to="/logs" active-class="active"><fa :icon="faStream" :fixed-width="true"/>{{ i18n.t('logs') }}</router-link></li>
			<li><router-link to="/db" active-class="active"><fa :icon="faDatabase" :fixed-width="true"/>{{ i18n.t('db') }}</router-link></li>
			<li><router-link to="/moderators" active-class="active"><fa :icon="faHeadset" :fixed-width="true"/>{{ i18n.t('moderators') }}</router-link></li>
			<li><router-link to="/users" active-class="active"><fa icon="users" :fixed-width="true"/>{{ i18n.t('users') }}</router-link></li>
			<li><router-link to="/drive" active-class="active"><fa icon="cloud" :fixed-width="true"/>{{ i18n.t('@.drive') }}</router-link></li>
			<li><router-link to="/federation" active-class="active"><fa :icon="faGlobe" :fixed-width="true"/>{{ i18n.t('federation') }}</router-link></li>
			<li><router-link to="/federation-classic" active-class="active"><fa :icon="faGlobe" :fixed-width="true"/>{{ i18n.t('federation') }} (classic)</router-link></li>
			<li><router-link to="/relays" active-class="active"><fa :icon="faProjectDiagram" :fixed-width="true"/>{{ i18n.t('relays') }}</router-link></li>
			<li><router-link to="/emoji" active-class="active"><fa :icon="faGrin" :fixed-width="true"/>{{ i18n.t('emoji') }}</router-link></li>
			<li><router-link to="/emoji-insider" active-class="active"><fa :icon="faGrin" :fixed-width="true"/>{{ i18n.t('emoji') }} (insider)</router-link></li>
			<li><router-link to="/announcements" active-class="active"><fa icon="broadcast-tower" :fixed-width="true"/>{{ i18n.t('announcements') }}</router-link></li>
			<li><router-link to="/abuse" active-class="active"><fa :icon="faExclamationCircle" :fixed-width="true"/>{{ i18n.t('abuse') }}</router-link></li>
		</ul>
		<div class="back-to-misskey">
			<!--邪道な気がするけど動くと思うからヨシ-->
			<a href="/queue"><fa :icon="faChartLine"/> {{ i18n.t('queue') }} {{ i18n.t('dashboard') }}</a>
			<a href="/"><fa :icon="faArrowLeft"/> {{ i18n.t('back-to-misskey') }}</a>
		</div>
		<div class="version">
			<small>Misskey {{ version }}</small>
		</div>
	</nav>
	<main>
		<div class="page">
			<div v-if="page == 'dashboard'"><x-dashboard/></div>
			<div v-if="page == 'instance'"><x-instance/></div>
			<div v-if="page == 'queue'"><x-queue/></div>
			<div v-if="page == 'logs'"><x-logs/></div>
			<div v-if="page == 'db'"><x-db/></div>
			<div v-if="page == 'moderators'"><x-moderators/></div>
			<div v-if="page == 'users'"><x-users/></div>
			<div v-if="page == 'emoji'"><x-emoji/></div>
			<div v-if="page == 'emoji-insider'"><x-emoji-insider/></div>
			<div v-if="page == 'announcements'"><x-announcements/></div>
			<div v-if="page == 'drive'"><x-drive/></div>
			<div v-if="page == 'federation'"><x-federation/></div>
			<div v-if="page == 'federation-classic'"><x-federation-classic/></div>
			<div v-if="page == 'relays'"><x-relays/></div>
			<div v-if="page == 'abuse'"><x-abuse/></div>
		</div>
	</main>
</div>
</template>

<script setup lang="ts">
import { computed, provide, ref } from 'vue';
import { i18n as _i18n } from '../../i18n';
import { version } from '../../config';
import XDashboard from './dashboard.vue';
import XInstance from './instance.vue';
import XQueue from './queue.vue';
import XLogs from './logs.vue';
import XDb from './db.vue';
import XModerators from './moderators.vue';
import XEmoji from './emoji.vue';
import XEmojiInsider from './emoji-insider.vue';
import XAnnouncements from './announcements.vue';
import XUsers from './users.vue';
import XDrive from './drive.vue';
import XAbuse from './abuse.vue';
import XFederation from './federation.vue';
import XFederationClassic from './federation-classic.vue';
import XRelays from './relays.vue';

import { faHeadset, faArrowLeft, faGlobe, faProjectDiagram, faExclamationCircle, faTasks, faStream, faDatabase, faChartLine } from '@fortawesome/free-solid-svg-icons';
import { faGrin } from '@fortawesome/free-regular-svg-icons';
import { useRoute } from 'vue-router';
import { AYUX } from '../../stores/ayux';

const i = AYUX().get('i');

// Detect the user agent
const ua = navigator.userAgent.toLowerCase();
const isMobile = /mobile|iphone|ipad|android/.test(ua);

provide('isMobile', isMobile);

const i18n = _i18n('admin/views/index.vue');

const navOpend = ref<boolean>(!isMobile);

const route = useRoute();

const page = computed(() => {
	return route.params.page;
});
</script>

<script lang="ts">
/*
import { defineComponent } from 'vue';
import { i18n as _i18n } from '../../i18n';
import { version } from '../../config';
import XDashboard from './dashboard.vue';
import XInstance from './instance.vue';
import XQueue from './queue.vue';
import XLogs from './logs.vue';
import XDb from './db.vue';
import XModerators from './moderators.vue';
import XEmoji from './emoji.vue';
import XEmojiInsider from './emoji-insider.vue';
import XAnnouncements from './announcements.vue';
import XUsers from './users.vue';
import XDrive from './drive.vue';
import XAbuse from './abuse.vue';
import XFederation from './federation.vue';
import XFederationClassic from './federation-classic.vue';
import XRelays from './relays.vue';

import { faHeadset, faArrowLeft, faGlobe, faProjectDiagram, faExclamationCircle, faTasks, faStream, faDatabase, faChartLine } from '@fortawesome/free-solid-svg-icons';
import { faGrin } from '@fortawesome/free-regular-svg-icons';

// Detect the user agent
const ua = navigator.userAgent.toLowerCase();
const isMobile = /mobile|iphone|ipad|android/.test(ua);

export default defineComponent({
	compatConfig: {
		MODE: 3,
	},
	components: {
		XDashboard,
		XInstance,
		XQueue,
		XLogs,
		XDb,
		XModerators,
		XEmoji,
		XEmojiInsider,
		XAnnouncements,
		XUsers,
		XDrive,
		XAbuse,
		XFederation,
		XFederationClassic,
		XRelays,
	},
	provide: {
		isMobile,
	},
	data() {
		return {
			i18n: _i18n('admin/views/index.vue'),
			version,
			isMobile,
			navOpend: !isMobile,
			faGrin,
			faArrowLeft,
			faHeadset,
			faGlobe,
			faProjectDiagram,
			faExclamationCircle,
			faTasks,
			faStream,
			faDatabase,
			faChartLine,
		};
	},
	computed: {
		page() {
			return this.$route.params.page;
		},
	},
});
*/
</script>

<style lang="stylus" scoped>
.mk-admin
	$headerHeight = 48px

	display flex
	height 100%

	> header
		position fixed
		top 0
		z-index 10000
		width 100%
		color var(--mobileHeaderFg)
		background-color var(--mobileHeaderBg)
		box-shadow 0 1px 0 rgba(#000, 0.075)

		&, *
			user-select none

		> span
			display block
			line-height $headerHeight
			text-align center

		> .nav
			display block
			position absolute
			top 0
			left 0
			z-index 10001
			padding 0
			width $headerHeight
			font-size 1.4em
			line-height $headerHeight
			border-right solid 1px rgba(#000, 0.1)

			> [data-icon]
				transition all 0.2s ease

	> nav
		position fixed
		z-index 20001
		top 0
		left 0
		width 250px
		height 100vh
		overflow auto
		background #333
		color #fff

		> .mi
			text-align center

			> svg
				width 24px
				height 82px
				vertical-align top
				fill #fff
				opacity 0.7

		> .me
			display flex
			margin 0 16px 16px 16px
			padding 16px 0
			align-items center
			border-top solid 1px #555
			border-bottom solid 1px #555

			> .avatar
				height 48px
				border-radius 100%
				vertical-align middle

			> .name
				margin 0 16px
				padding 0
				color #fff
				overflow hidden
				text-overflow ellipsis
				white-space nowrap
				font-size 15px

		> .back-to-misskey
			margin 16px 16px 0 16px
			padding 0
			border-top solid 1px #555

			> a
				display block
				padding 16px 4px
				color inherit
				text-decoration none
				color #eee
				font-size 15px

				&:hover
					color #fff

				> [data-icon]
					margin-right 6px

		> .version
			margin 0 16px 16px 16px
			padding-top 16px
			border-top solid 1px #555
			text-align center

			> small
				opacity 0.7

		> ul
			margin 0
			padding 0
			list-style none
			font-size 15px

			> li > a
				display block
				padding 10px 16px
				margin 0
				user-select none
				color #eee
				transition margin-left 0.2s ease

				&:hover
					color #fff

				> [data-icon]
					margin-right 6px

				&.active
					margin-left 8px
					color var(--primary) !important

					&:after
						content ""
						display block
						position absolute
						top 0
						right 0
						bottom 0
						margin auto 0
						height 0
						border-top solid 16px transparent
						border-right solid 16px var(--bg)
						border-bottom solid 16px transparent
						border-left solid 16px transparent

	> .nav-backdrop
		position fixed
		top 0
		left 0
		z-index 20000
		width 100%
		height 100%
		background var(--mobileNavBackdrop)

	> main
		width 100%
		padding 0 0 0 250px

		> .page
			max-width 1150px

			@media (min-width 500px)
				padding 16px

	&.isMobile
		> main
			padding $headerHeight 0 0 0

</style>
